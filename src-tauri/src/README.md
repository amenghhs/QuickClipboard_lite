# Rust 后端模块结构

## 核心架构

QuickClipboard 的 Rust 后端基于 Tauri 框架构建，提供高性能的系统级功能和安全的前后端通信。

## 模块结构

### 入口模块

#### `main.rs` - 应用程序入口
- 应用程序启动和初始化
- Tauri 应用配置
- 系统托盘初始化

#### `lib.rs` - 库入口和命令注册
- Tauri 命令注册
- 模块声明和导出
- 应用程序构建配置

### 核心功能模块

#### `clipboard_content.rs` - 剪贴板内容定义
- 剪贴板内容数据结构
- 内容类型枚举和处理
- 内容序列化和反序列化
- 内容验证和转换

#### `clipboard_history.rs` - 剪贴板历史管理
- 历史记录存储和检索
- 历史数据持久化
- 历史记录清理和维护
- 历史查询和过滤

#### `clipboard_monitor.rs` - 剪贴板监听
- 系统剪贴板变化监听
- 剪贴板事件处理
- 内容变化检测
- 自动同步机制

#### `commands.rs` - Tauri 命令接口
- 前端调用的 API 接口
- 剪贴板操作命令
- 设置管理命令
- 文件操作命令
- 系统交互命令

#### `settings.rs` - 设置管理
- 应用设置的加载和保存
- 设置数据结构定义
- 默认配置管理
- 设置验证和迁移
- JSON 序列化/反序列化

### 系统集成模块

#### `keyboard_hook.rs` - 全局键盘钩子
- 全局快捷键监听
- 键盘事件处理
- 预览窗口快捷键
- 截屏快捷键
- 系统级键盘拦截

#### `tray.rs` - 系统托盘
- 托盘图标管理
- 托盘菜单创建
- 托盘事件处理
- 应用图标加载
- 托盘交互逻辑

#### `window_management.rs` - 窗口管理
- 主窗口控制
- 窗口状态管理
- 窗口显示/隐藏
- 窗口位置和大小
- 多窗口协调

#### `window_effects.rs` - 窗口特效
- 窗口透明度控制
- 窗口阴影效果
- 窗口动画处理
- 平台特定窗口效果

### 专用功能模块

#### `preview_window.rs` - 预览窗口
- 预览窗口创建和管理
- 预览内容渲染
- 滚动事件处理
- 窗口定位和尺寸
- 预览窗口生命周期

#### `screenshot.rs` - 截屏功能
- 屏幕截图捕获
- 截图区域选择
- 图片格式处理
- 截图保存和管理
- 截图质量控制

#### `sound_manager.rs` - 音效管理
- 音效文件播放
- 音效设置管理
- 并发播放控制
- 音效资源管理
- 系统音效集成

### 数据和工具模块

#### `image_manager.rs` - 图片管理
- 图片文件存储
- 图片格式转换
- 图片缓存管理
- 图片清理和优化
- 图片元数据处理

#### `groups.rs` - 分组管理
- 剪贴板项目分组
- 分组数据结构
- 分组操作接口
- 分组持久化
- 分组查询和过滤

#### `quick_texts.rs` - 常用文本管理
- 常用文本存储和管理
- 常用文本CRUD操作
- 常用文本分类和标签
- 常用文本导入导出

## 模块间依赖关系

```
src-tauri/src/
├── clipboard_content.rs    # 剪贴板内容处理
├── clipboard_history.rs    # 剪贴板历史
├── clipboard_monitor.rs    # 剪贴板监控
├── commands.rs             # Tauri命令集合
├── groups.rs               # 分组功能
├── image_manager.rs        # 图片管理
├── keyboard_hook.rs        # 键盘钩子
├── lib.rs                  # 库入口
├── main.rs                 # 主程序入口
├── preview_window.rs       # 预览窗口
├── quick_texts.rs          # 快速文本
├── screenshot.rs           # 截图功能
├── settings.rs             # 设置管理
├── sound_manager.rs        # 声音管理
├── tray.rs                 # 系统托盘
├── window_effects.rs       # 窗口效果
└── window_management.rs    # 窗口管理
```

## 数据流向

### 1. 用户交互流程
```
用户操作 → keyboard_hook.rs → 相应功能模块 → commands.rs → 前端
```

### 2. 剪贴板监听流程
```
系统剪贴板变化 → clipboard_manager.rs → 数据处理 → 前端通知
```

### 3. 设置管理流程
```
前端设置变更 → commands.rs → settings.rs → 配置持久化 → 模块更新
```

### 4. 预览窗口流程
```
快捷键触发 → keyboard_hook.rs → preview_window.rs → 窗口显示 → 用户交互
```

## 关键特性

### 性能优化
- 异步处理避免阻塞
- 内存池管理图片数据
- 智能缓存机制
- 并发控制和限流

### 安全性
- 类型安全的 Rust 代码
- 内存安全保证
- 安全的前后端通信
- 输入验证和错误处理

### 跨平台支持
- Windows 系统集成
- 条件编译支持多平台
- 平台特定功能封装
- 统一的 API 接口

### 可扩展性
- 模块化设计
- 清晰的接口定义
- 插件式功能扩展
- 配置驱动的行为
